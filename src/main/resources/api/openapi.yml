openapi: 3.0.3
info:
  title: MTG Deckbuilder API
  version: 1.0.0
  description: RESTful API for managing Magic The Gathering card collections and decks
servers:
  - url: /api/v1
    description: Version 1 - Current stable API
paths:
  /sets:
    get:
      summary: List all sets
      operationId: listSets
      tags:
        - Sets
      parameters:
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of items per page
        - name: pageNumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Page number to retrieve (0-indexed)
      responses:
        '200':
          description: List of sets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Set'
    post:
      summary: Create a new set
      operationId: createSet
      tags:
        - Sets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Set'
      responses:
        '201':
          description: Set created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Set'
  /sets/{id}:
    get:
      summary: Get a set by ID
      operationId: getSetById
      tags:
        - Sets
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Set details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Set'
        '404':
          description: Set not found
    put:
      summary: Update a set
      operationId: updateSet
      tags:
        - Sets
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Set'
      responses:
        '200':
          description: Set updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Set'
        '404':
          description: Set not found
    delete:
      summary: Delete a set
      operationId: deleteSet
      tags:
        - Sets
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '204':
          description: Set deleted
        '404':
          description: Set not found

  /cards:
    get:
      summary: List all cards
      operationId: listCards
      tags:
        - Cards
      parameters:
        - name: pagesize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of items per page
        - name: pagenumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Page number to retrieve (0-indexed)
      responses:
        '200':
          description: List of cards
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Card'
    post:
      summary: Create a new card
      operationId: createCard
      tags:
        - Cards
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Card'
      responses:
        '201':
          description: Card created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'
        '400':
          description: Invalid input
  /cards/{id}:
    get:
      summary: Get a card by ID
      operationId: getCardById
      tags:
        - Cards
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Card details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'
        '404':
          description: Card not found
    put:
      summary: Update a card
      operationId: updateCard
      tags:
        - Cards
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Card'
      responses:
        '200':
          description: Card updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'
        '404':
          description: Card not found
    delete:
      summary: Delete a card
      operationId: deleteCard
      tags:
        - Cards
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '204':
          description: Card deleted
        '404':
          description: Card not found

  /users:
    get:
      summary: List all users
      operationId: listUsers
      tags:
        - Users
      parameters:
        - name: pagesize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: pagenumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
    post:
      summary: Create a new user
      operationId: createUser
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
  /users/{id}:
    get:
      summary: Get a user by ID
      operationId: getUserById
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    put:
      summary: Update a user
      operationId: updateUser
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    delete:
      summary: Delete a user
      operationId: deleteUser
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '204':
          description: User deleted

  /users/{id}/decks:
    get:
      summary: Get all decks for a user
      operationId: getUserDecks
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
        - name: pagesize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: pagenumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of complete decks for the user with sideboard and maybeboard
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CompleteDeck'

  /formats:
    get:
      summary: List all formats
      operationId: listFormats
      tags:
        - Formats
      parameters:
        - name: pagesize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: pagenumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of formats
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Format'
    post:
      summary: Create a new format
      operationId: createFormat
      tags:
        - Formats
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Format'
      responses:
        '201':
          description: Format created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Format'
  /formats/{id}:
    get:
      summary: Get a format by ID
      operationId: getFormatById
      tags:
        - Formats
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Format details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Format'
    put:
      summary: Update a format
      operationId: updateFormat
      tags:
        - Formats
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Format'
      responses:
        '200':
          description: Format updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Format'
    delete:
      summary: Delete a format
      operationId: deleteFormat
      tags:
        - Formats
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '204':
          description: Format deleted

  /decks:
    get:
      summary: List all decks
      operationId: listDecks
      tags:
        - Decks
      parameters:
        - name: pagesize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: pagenumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of complete decks with sideboard and maybeboard
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CompleteDeck'
    post:
      summary: Create a new deck
      operationId: createDeck
      tags:
        - Decks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Deck'
      responses:
        '201':
          description: Deck created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Deck'
  /decks/{id}:
    get:
      summary: Get a deck by ID
      operationId: getDeckById
      tags:
        - Decks
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Complete deck with sideboard and maybeboard
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompleteDeck'
        '404':
          description: Deck not found
    put:
      summary: Update a deck
      operationId: updateDeck
      tags:
        - Decks
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Deck'
      responses:
        '200':
          description: Deck updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Deck'
    delete:
      summary: Delete a deck
      operationId: deleteDeck
      tags:
        - Decks
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '204':
          description: Deck deleted

  /tags:
    get:
      summary: List all tags
      operationId: listTags
      tags:
        - Tags
      parameters:
        - name: pagesize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: pagenumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of tags
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tag'
    post:
      summary: Create a new tag
      operationId: createTag
      tags:
        - Tags
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Tag'
      responses:
        '201':
          description: Tag created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
  /tags/{id}:
    get:
      summary: Get a tag by ID
      operationId: getTagById
      tags:
        - Tags
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Tag details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
    put:
      summary: Update a tag
      operationId: updateTag
      tags:
        - Tags
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Tag'
      responses:
        '200':
          description: Tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
    delete:
      summary: Delete a tag
      operationId: deleteTag
      tags:
        - Tags
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '204':
          description: Tag deleted

  /card_tag:
    get:
      summary: List all card tag entries
      operationId: listCardTags
      tags:
        - CardTags
      parameters:
        - name: pagesize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: pagenumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of card tag entries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CardTag'
    post:
      summary: Create a new card tag entry
      operationId: createCardTag
      tags:
        - CardTags
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CardTag'
      responses:
        '201':
          description: Card tag entry created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardTag'

  /cards/{id}/tags:
    get:
      summary: List all tags for a card
      operationId: listTagsForCard
      tags:
        - Cards
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: List of tags for the card
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CardTag'

  /cards/{id}/tags/{tag_id}:
    put:
      summary: Update card tag entry
      operationId: updateCardTag
      tags:
        - Cards
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
        - name: tag_id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CardTag'
      responses:
        '200':
          description: Card tag entry updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardTag'
    delete:
      summary: Delete card tag entry
      operationId: deleteCardTag
      tags:
        - Cards
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
        - name: tag_id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '204':
          description: Card tag entry deleted

  /formats/{id}/cards:
    get:
      summary: List all cards for a format
      operationId: listCardsForFormat
      tags:
        - Cards
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
        - name: pagesize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: pagenumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of cards for the format
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Card'

  /cards/search:
    get:
      summary: Search cards with multiple filters
      operationId: searchCards
      tags:
        - Cards
      parameters:
        - name: name
          in: query
          required: false
          schema:
            type: string
            minLength: 1
            maxLength: 200
          description: Search by card name (partial match)
          example: "Lightning"
        - name: type
          in: query
          required: false
          schema:
            type: string
            minLength: 1
            maxLength: 50
          description: Search by card type
          example: "Instant"
        - name: rarity
          in: query
          required: false
          schema:
            type: string
            enum: [common, uncommon, rare, mythic, special]
          description: Filter by card rarity
          example: "rare"
        - name: colors
          in: query
          required: false
          schema:
            type: string
            pattern: '^[WUBRG]*$'
            maxLength: 5
          description: Filter by color identity (combination of W, U, B, R, G)
          example: "UB"
        - name: cmc_min
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            maximum: 20
          description: Minimum converted mana cost
          example: 1
        - name: cmc_max
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            maximum: 20
          description: Maximum converted mana cost
          example: 5
        - name: power_min
          in: query
          required: false
          schema:
            type: string
            pattern: '^[0-9]+$'
          description: Minimum power for creatures
          example: "2"
        - name: power_max
          in: query
          required: false
          schema:
            type: string
            pattern: '^[0-9]+$'
          description: Maximum power for creatures
          example: "5"
        - name: toughness_min
          in: query
          required: false
          schema:
            type: string
            pattern: '^[0-9]+$'
          description: Minimum toughness for creatures
          example: "1"
        - name: toughness_max
          in: query
          required: false
          schema:
            type: string
            pattern: '^[0-9]+$'
          description: Maximum toughness for creatures
          example: "4"
        - name: set_id
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
          description: Filter by specific set ID
          example: 1
        - name: format_id
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
          description: Filter by legal format
          example: 1
        - name: text_contains
          in: query
          required: false
          schema:
            type: string
            minLength: 1
            maxLength: 100
          description: Search in card text (rules text)
          example: "damage"
        - name: keywords
          in: query
          required: false
          schema:
            type: string
            minLength: 1
            maxLength: 200
          description: Search by keywords (comma-separated)
          example: "flying,first strike"
        - name: is_foil
          in: query
          required: false
          schema:
            type: boolean
          description: Filter foil cards only
        - name: is_promo
          in: query
          required: false
          schema:
            type: boolean
          description: Filter promotional cards only
        - name: language
          in: query
          required: false
          schema:
            type: string
            pattern: '^[a-z]{2}$'
            default: "en"
          description: Filter by card language
          example: "en"
        - name: pagesize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of items per page
        - name: pagenumber
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Page number to retrieve (0-indexed)
        - name: sort_by
          in: query
          required: false
          schema:
            type: string
            enum: [name, cmc, rarity, type, set, power, toughness]
            default: "name"
          description: Sort results by field
        - name: sort_order
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: "asc"
          description: Sort order (ascending or descending)
      responses:
        '200':
          description: List of cards matching the search criteria
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardSearchResponse'
        '400':
          description: Invalid search parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchError'

  /cards/random:
    get:
      summary: Get random cards with optional filters
      operationId: getRandomCards
      tags:
        - Cards
      parameters:
        - name: count
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 1
          description: Number of random cards to return
        - name: type
          in: query
          required: false
          schema:
            type: string
          description: Filter random cards by type
        - name: rarity
          in: query
          required: false
          schema:
            type: string
            enum: [common, uncommon, rare, mythic, special]
          description: Filter random cards by rarity
        - name: format_id
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
          description: Filter random cards legal in format
      responses:
        '200':
          description: Random cards matching criteria
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Card'

components:
  schemas:
    Set:
      type: object
      required:
        - name
      properties:
        id:
          type: integer
          readOnly: true
        name:
          type: string
          minLength: 1
          maxLength: 100
          example: "Dominaria United"

    Keyword:
      type: object
      required:
        - name
      properties:
        id:
          type: integer
          readOnly: true
        name:
          type: string
          minLength: 1
          maxLength: 50
          example: "Flying"

    Card:
      type: object
      required:
        - card_name
        - cmc
        - type_line
        - card_type
        - rarity
        - card_text
        - image_url
        - language
      properties:
        id:
          type: integer
          readOnly: true
        card_name:
          type: string
          minLength: 1
          maxLength: 200
          example: "Lightning Bolt"
        mana_cost:
          type: string
          nullable: true
          minLength: 0
          maxLength: 50
          example: "{R}"
        cmc:
          type: integer
          minimum: 0
          maximum: 20
          example: 1
        color_identity:
          type: string
          nullable: true
          minLength: 0
          maxLength: 10
          pattern: '^[WUBRG]*$'
          example: "R"
        type_line:
          type: string
          minLength: 1
          maxLength: 200
          description: "Full original type line (e.g., 'Legendary Creature — Goblin Wizard')"
          example: "Instant"
        card_type:
          type: string
          minLength: 1
          maxLength: 50
          description: "Parsed card type (e.g., 'Creature', 'Instant')"
          example: "Instant"
        card_subtype:
          type: string
          maxLength: 100
          description: "Parsed subtypes as string (e.g., 'Goblin Wizard')"
        card_supertype:
          type: string
          maxLength: 50
          description: "Parsed supertype (e.g., 'Legendary', 'Basic')"
        rarity:
          type: string
          enum: [common, uncommon, rare, mythic, special]
          example: "uncommon"
        card_text:
          type: string
          maxLength: 500
          example: "Lightning Bolt deals 3 damage to any target."
        flavor_text:
          type: string
          maxLength: 500
        power:
          type: string
          maxLength: 10
          pattern: '^[0-9*+\\-X]+$'
        toughness:
          type: string
          maxLength: 10
          pattern: '^[0-9*+\\-X]+$'
        unlimited_copies:
          type: boolean
          default: false
        image_url:
          type: string
          format: uri
          maxLength: 500
          example: "https://example.com/cards/lightning_bolt.jpg"
        foil:
          type: boolean
          default: false
        game_changer:
          type: boolean
          default: false
        related_card:
          type: integer
          minimum: 1
        language:
          type: string
          minLength: 2
          maxLength: 10
          pattern: '^[a-z]{2}$'
          default: "en"
          example: "en"
        embedding:
          type: array
          items:
            type: number
          minItems: 999
          maxItems: 999
        archetype:
          type: string
          maxLength: 50
        card_set:
          type: integer
          minimum: 1
        collector_number:
          type: string
          maxLength: 20
          description: "Card's collector number in the set (e.g., '001', '264★')"
          example: "001"
        promo:
          type: boolean
          default: false
          description: "Indicates if this is a promotional version of the card"
        variation:
          type: boolean
          default: false
          description: "Indicates if this is an alternate art or variant version"

    User:
      type: object
      required:
        - name
        - username
        - email
        - country
      properties:
        id:
          type: integer
          readOnly: true
        name:
          type: string
          minLength: 1
          maxLength: 100
          example: "John Doe"
        username:
          type: string
          minLength: 3
          maxLength: 50
          pattern: '^[a-zA-Z0-9_-]+$'
          example: "johndoe123"
        registration_date:
          type: string
          format: date-time
          readOnly: true
        hashed_password:
          type: string
          writeOnly: true
          minLength: 8
          maxLength: 255
        email:
          type: string
          format: email
          maxLength: 100
          example: "johndoe@example.com"
        country:
          type: string
          minLength: 2
          maxLength: 50
          example: "USA"

    Format:
      type: object
      required:
        - format_name
        - deck_size
      properties:
        id:
          type: integer
          readOnly: true
        format_name:
          type: string
          minLength: 1
          maxLength: 50
          example: "Standard"
        deck_size:
          type: integer
          minimum: 1
          maximum: 250
          example: 60

    Deck:
      type: object
      required:
        - deck_name
        - deck_type
        - user_id
      properties:
        id:
          type: integer
          readOnly: true
        deck_name:
          type: string
          minLength: 1
          maxLength: 100
          example: "My Mill Deck"
        creation_date:
          type: string
          format: date-time
          readOnly: true
        last_modification:
          type: string
          format: date-time
          readOnly: true
        deck_type:
          type: string
          enum: [main, sideboard, maybeboard]
          default: main
          example: "main"
        description:
          type: string
          maxLength: 999
        is_private:
          type: boolean
          default: true
        tournament:
          type: string
          maxLength: 100
        share_url:
          type: string
          format: uri
          maxLength: 200
          readOnly: true
        parent_deck_id:
          type: integer
          minimum: 1
        format:
          type: integer
          minimum: 1
        user_id:
          type: integer
          minimum: 1
        deck_contents:
          type: array
          items:
            $ref: '#/components/schemas/CardDeck'
          maxItems: 250

    CompleteDeck:
      type: object
      required:
        - id
        - user_id
        - deck_name
        - main_board
      properties:
        id:
          type: integer
          readOnly: true
        user_id:
          type: integer
          minimum: 1
        deck_name:
          type: string
          minLength: 1
          maxLength: 100
          example: "My Complete Deck"
        main_board:
          type: array
          items:
            $ref: '#/components/schemas/CardDeck'
          maxItems: 250
        side_board:
          type: array
          items:
            $ref: '#/components/schemas/CardDeck'
          maxItems: 250
        maybe_board:
          type: array
          items:
            $ref: '#/components/schemas/CardDeck'
          maxItems: 250
        creation_date:
          type: string
          format: date-time
          readOnly: true
        last_modification:
          type: string
          format: date-time
          readOnly: true
        description:
          type: string
          maxLength: 999
        is_private:
          type: boolean
          default: true
        tournament:
          type: string
          maxLength: 100
        share_url:
          type: string
          format: uri
          maxLength: 200
          readOnly: true
        parent_deck_id:
          type: integer
          minimum: 1
        format:
          type: integer
          minimum: 1

    Tag:
      type: object
      required:
        - name
      properties:
        id:
          type: integer
          readOnly: true
        name:
          type: string
          minLength: 1
          maxLength: 50
          example: "Mill"

    CardLegality:
      type: object
      required:
        - card_id
        - format_id
        - legality_status
      properties:
        card_id:
          type: integer
          minimum: 1
        format_id:
          type: integer
          minimum: 1
        legality_status:
          type: string
          enum: [legal, banned, restricted, not_legal]
          example: "legal"

    CardDeck:
      type: object
      required:
        - card_id
        - deck_id
        - quantity
      properties:
        card_id:
          type: integer
          minimum: 1
        deck_id:
          type: integer
          minimum: 1
        quantity:
          type: integer
          minimum: 1
          maximum: 99
          example: 4

    CardTag:
      type: object
      required:
        - card_id
        - tag_id
        - weight
        - confidence
        - source
      properties:
        card_id:
          type: integer
          minimum: 1
        tag_id:
          type: integer
          minimum: 1
        weight:
          type: number
          format: float
          minimum: 0.0
          maximum: 10.0
          example: 1.0
        confidence:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          example: 0.95
        source:
          type: string
          enum: [manual, ai_text, ai_vision, heuristic, admin]
          example: "ai_text"
        model_version:
          type: string
          maxLength: 50
          example: "gpt-4-turbo"
        created_at:
          type: string
          format: date-time
          readOnly: true

    CardKeyword:
      type: object
      required:
        - card_id
        - keyword_id
      properties:
        card_id:
          type: integer
          minimum: 1
        keyword_id:
          type: integer
          minimum: 1

    CardSearchResponse:
      type: object
      required:
        - cards
        - total_count
        - page_info
      properties:
        cards:
          type: array
          items:
            $ref: '#/components/schemas/Card'
        total_count:
          type: integer
          description: Total number of cards matching the criteria
          example: 150
        page_info:
          $ref: '#/components/schemas/PageInfo'

    PageInfo:
      type: object
      required:
        - current_page
        - page_size
        - total_pages
        - has_next_page
        - has_previous_page
      properties:
        current_page:
          type: integer
          description: Current page number (0-indexed)
          example: 0
        page_size:
          type: integer
          description: Number of items per page
          example: 20
        total_pages:
          type: integer
          description: Total number of pages
          example: 8
        has_next_page:
          type: boolean
          description: Whether there is a next page
          example: true
        has_previous_page:
          type: boolean
          description: Whether there is a previous page
          example: false

    SearchError:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
          example: "Invalid parameter: cmc_min must be less than or equal to cmc_max"
        details:
          type: array
          items:
            type: string
          description: Detailed error messages
          example: ["cmc_min cannot be greater than cmc_max", "Invalid color combination"]

  parameters:
    PageSize:
      name: pagesize
      in: query
      required: false
      description: Number of items per page (1-100)
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
    PageNumber:
      name: pagenumber
      in: query
      required: false
      description: Page number to retrieve (0-indexed, must be non-negative)
      schema:
        type: integer
        minimum: 0
        default: 0

tags:
  - name: Sets
    description: "Operations related to Magic: The Gathering card sets"
  - name: Cards
    description: "Operations related to Magic: The Gathering cards"
  - name: Users
    description: "Operations related to users"
  - name: Formats
    description: "Operations related to game formats"
  - name: Decks
    description: "Operations related to decks"
  - name: Tags
    description: "Operations related to tags"
  - name: CardTags
    description: "Operations related to card-tag relationships"
